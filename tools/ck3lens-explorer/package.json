{
  "name": "ck3lens-explorer",
  "displayName": "CK3 Lens Explorer",
  "description": "CK3 mod development environment - game state explorer, conflict resolution, real-time linting powered by ck3raven",
  "version": "0.1.0",
  "publisher": "ck3-modding",
  "repository": {
    "type": "git",
    "url": "https://github.com/ck3user75233/ck3raven"
  },
  "engines": {
    "vscode": "^1.96.0"
  },
  "categories": [
    "Linters",
    "Programming Languages",
    "Other"
  ],
  "keywords": [
    "ck3",
    "crusader kings 3",
    "paradox",
    "clausewitz",
    "modding",
    "ck3raven",
    "game state"
  ],
  "activationEvents": [
    "onStartupFinished"
  ],
  "main": "./out/extension.js",
  "enabledApiProposals": [
    "mcpServerDefinitionProvider"
  ],
  "contributes": {
    "mcpServerDefinitionProviders": [
      {
        "id": "ck3lens",
        "label": "CK3 Lens MCP Server"
      }
    ],
    "languages": [
      {
        "id": "paradox-script",
        "aliases": [
          "Paradox Script",
          "CK3 Script",
          "Clausewitz"
        ],
        "extensions": [
          ".txt"
        ],
        "configuration": "./language-configuration.json",
        "firstLine": "^#.*[Ee]vent|^#.*[Dd]ecision|^#.*[Tt]rait|^#.*[Cc]ulture"
      },
      {
        "id": "paradox-localization",
        "aliases": [
          "Paradox Localization",
          "CK3 Localization"
        ],
        "extensions": [
          ".yml"
        ],
        "configuration": "./language-configuration.json",
        "firstLine": "^l_english:|^l_french:|^l_german:|^l_spanish:|^l_simp_chinese:|^l_russian:|^l_korean:"
      }
    ],
    "grammars": [
      {
        "language": "paradox-script",
        "scopeName": "source.paradox-script",
        "path": "./syntaxes/paradox-script.tmLanguage.json"
      },
      {
        "language": "paradox-localization",
        "scopeName": "source.paradox-localization",
        "path": "./syntaxes/paradox-localization.tmLanguage.json"
      }
    ],
    "viewsContainers": {
      "activitybar": [
        {
          "id": "ck3lens",
          "title": "CK3 Lens",
          "icon": "media/ck3lens-sidebar.svg"
        }
      ]
    },
    "views": {
      "ck3lens": [
        {
          "id": "ck3lens.agentView",
          "name": "Tools",
          "type": "tree",
          "icon": "$(tools)",
          "contextualTitle": "CK3 Lens",
          "visibility": "visible"
        },
        {
          "id": "ck3lens.contractsView",
          "name": "Contracts & Operations",
          "type": "tree",
          "icon": "$(notebook)",
          "contextualTitle": "CK3 Lens",
          "visibility": "visible"
        },
        {
          "id": "ck3lens.playsetView",
          "name": "Active Playset",
          "type": "tree",
          "icon": "$(list-selection)",
          "contextualTitle": "CK3 Lens"
        },
        {
          "id": "ck3lens.explorerView",
          "name": "Game State Explorer",
          "type": "tree",
          "icon": "$(globe)",
          "contextualTitle": "CK3 Lens"
        },
        {
          "id": "ck3lens.conflictsView",
          "name": "Conflicts",
          "type": "tree",
          "icon": "$(git-compare)",
          "contextualTitle": "CK3 Lens"
        },
        {
          "id": "ck3lens.issuesView",
          "name": "Issues",
          "type": "tree",
          "icon": "$(issues)",
          "contextualTitle": "CK3 Lens"
        }
      ]
    },
    "viewsWelcome": [
      {
        "view": "ck3lens.explorerView",
        "contents": "No ck3raven database loaded.\n[Initialize CK3 Lens](command:ck3lens.initSession)\n\nMake sure you have built the ck3raven database first."
      }
    ],
    "commands": [
      {
        "command": "ck3lens.initSession",
        "title": "CK3 Lens: Initialize Session",
        "icon": "$(database)"
      },
      {
        "command": "ck3lens.refreshViews",
        "title": "CK3 Lens: Refresh All Views",
        "icon": "$(refresh)"
      },
      {
        "command": "ck3lens.validateFile",
        "title": "CK3 Lens: Validate Current File",
        "icon": "$(check)"
      },
      {
        "command": "ck3lens.validateWorkspace",
        "title": "CK3 Lens: Validate Entire Workspace",
        "icon": "$(checklist)"
      },
      {
        "command": "ck3lens.searchSymbols",
        "title": "CK3 Lens: Search Symbols",
        "icon": "$(search)"
      },
      {
        "command": "ck3lens.showConflicts",
        "title": "CK3 Lens: Show Conflicts",
        "icon": "$(git-compare)"
      },
      {
        "command": "ck3lens.goToDefinition",
        "title": "CK3 Lens: Go to Definition",
        "icon": "$(go-to-file)"
      },
      {
        "command": "ck3lens.findReferences",
        "title": "CK3 Lens: Find All References",
        "icon": "$(references)"
      },
      {
        "command": "ck3lens.openInMergeEditor",
        "title": "CK3 Lens: Open in Merge Editor",
        "icon": "$(git-merge)"
      },
      {
        "command": "ck3lens.buildDatabase",
        "title": "CK3 Lens: Rebuild Database",
        "icon": "$(database)"
      },
      {
        "command": "ck3lens.runSetupWizard",
        "title": "CK3 Lens: Run Setup Wizard",
        "icon": "$(gear)"
      },
      {
        "command": "ck3lens.showSetupStatus",
        "title": "CK3 Lens: Show Setup Status",
        "icon": "$(info)"
      },
      {
        "command": "ck3lens.contracts.showOperationDetails",
        "title": "CK3 Lens: Show Operation Details",
        "icon": "$(info)"
      },
      {
        "command": "ck3lens.contracts.viewBugReports",
        "title": "CK3 Lens: View Bug Reports",
        "icon": "$(bug)"
      },
      {
        "command": "ck3lens.contracts.refresh",
        "title": "CK3 Lens: Refresh Contracts View",
        "icon": "$(refresh)"
      },
      {
        "command": "ck3lens.contracts.fileBugReport",
        "title": "CK3 Lens: File Bug Report",
        "icon": "$(bug)"
      },
      {
        "command": "ck3lens.setPlayset",
        "title": "CK3 Lens: Select Playset",
        "icon": "$(list-selection)"
      },
      {
        "command": "ck3lens.openAstViewer",
        "title": "CK3 Lens: Open AST Viewer",
        "icon": "$(symbol-structure)"
      },
      {
        "command": "ck3lens.openStudio",
        "title": "CK3 Studio: Create/Edit File",
        "icon": "$(new-file)"
      },
      {
        "command": "ck3lens.refreshIssues",
        "title": "CK3 Lens: Refresh Issues",
        "icon": "$(refresh)"
      },
      {
        "command": "ck3lens.navigateToIssue",
        "title": "CK3 Lens: Navigate to Issue",
        "icon": "$(go-to-file)"
      },
      {
        "command": "ck3lens.showConflictDetail",
        "title": "CK3 Lens: Show Conflict Detail",
        "icon": "$(info)"
      },
      {
        "command": "ck3lens.createOverridePatch",
        "title": "CK3 Lens: Create Override Patch",
        "icon": "$(new-file)"
      },
      {
        "command": "ck3lens.setupPlayset",
        "title": "CK3 Lens: Setup Active Playset",
        "icon": "$(library)"
      },
      {
        "command": "ck3lens.viewPlaysets",
        "title": "CK3 Lens: View Playsets",
        "icon": "$(list-unordered)"
      },
      {
        "command": "ck3lens.toggleLens",
        "title": "CK3 Lens: Toggle Lens On/Off",
        "icon": "$(eye)"
      },
      {
        "command": "ck3lens.selectMode",
        "title": "CK3 Lens: Select Mode",
        "icon": "$(symbol-event)"
      },
      {
        "command": "ck3lens.toggleAgentEngagement",
        "title": "CK3 Lens: Toggle Agent Engagement",
        "icon": "$(hubot)"
      },
      {
        "command": "ck3lens.openWidget",
        "title": "CK3 Lens: Open Widget Panel",
        "icon": "$(window)"
      },
      {
        "command": "ck3lens.hideWidget",
        "title": "CK3 Lens: Hide Widget Panel",
        "icon": "$(close)"
      },
      {
        "command": "ck3lens.openLogs",
        "title": "CK3 Lens: Open Logs",
        "icon": "$(output)"
      },
      {
        "command": "ck3lens.copyCurrentState",
        "title": "CK3 Lens: Copy Current State to Clipboard",
        "icon": "$(clippy)"
      },
      {
        "command": "ck3lens.mcp.reconnect",
        "title": "CK3 Lens: Reconnect MCP Server",
        "icon": "$(plug)"
      },
      {
        "command": "ck3lens.rules.toggle",
        "title": "Toggle Validation Rule",
        "icon": "$(check)"
      },
      {
        "command": "ck3lens.rules.setSeverity",
        "title": "Set Rule Severity",
        "icon": "$(settings)"
      },
      {
        "command": "ck3lens.rules.refresh",
        "title": "Refresh Validation Rules",
        "icon": "$(refresh)"
      },
      {
        "command": "ck3lens.rules.openConfig",
        "title": "Open Rules Config",
        "icon": "$(settings-gear)"
      },
      {
        "command": "ck3lens.rules.enableCk3lens",
        "title": "Enable CK3 Lens Mode Rules",
        "icon": "$(symbol-namespace)"
      },
      {
        "command": "ck3lens.rules.enableCk3ravenDev",
        "title": "Enable CK3 Raven Dev Mode Rules",
        "icon": "$(tools)"
      },
      {
        "command": "ck3lens.rules.disableAll",
        "title": "Disable All Rules",
        "icon": "$(circle-slash)"
      },
      {
        "command": "ck3lens.agent.initialize",
        "title": "Initialize Agent",
        "icon": "$(add)"
      },
      {
        "command": "ck3lens.agent.initializeWithMode",
        "title": "Initialize Agent with Mode",
        "icon": "$(symbol-event)"
      },
      {
        "command": "ck3lens.agent.reinitialize",
        "title": "Re-initialize Agent",
        "icon": "$(refresh)"
      },
      {
        "command": "ck3lens.agent.addSubAgent",
        "title": "Add Sub-agent",
        "icon": "$(add)"
      },
      {
        "command": "ck3lens.agent.clearAll",
        "title": "Clear All Agents",
        "icon": "$(trash)"
      }
    ],
    "menus": {
      "view/title": [
        {
          "command": "ck3lens.refreshViews",
          "when": "view =~ /ck3lens\\./",
          "group": "navigation"
        },
        {
          "command": "ck3lens.agent.initializeWithMode",
          "when": "view == ck3lens.agentView",
          "group": "navigation"
        },
        {
          "command": "ck3lens.agent.clearAll",
          "when": "view == ck3lens.agentView",
          "group": "navigation"
        },
        {
          "command": "ck3lens.setupPlayset",
          "when": "view == ck3lens.playsetView",
          "group": "navigation"
        },
        {
          "command": "ck3lens.viewPlaysets",
          "when": "view == ck3lens.playsetView",
          "group": "navigation"
        },
        {
          "command": "ck3lens.refreshIssues",
          "when": "view == ck3lens.issuesView",
          "group": "navigation"
        },
        {
          "command": "ck3lens.rules.enableCk3lens",
          "when": "view == ck3lens.rulesView",
          "group": "navigation@1"
        },
        {
          "command": "ck3lens.rules.enableCk3ravenDev",
          "when": "view == ck3lens.rulesView",
          "group": "navigation@2"
        },
        {
          "command": "ck3lens.rules.openConfig",
          "when": "view == ck3lens.rulesView",
          "group": "navigation@3"
        },
        {
          "command": "ck3lens.rules.refresh",
          "when": "view == ck3lens.rulesView",
          "group": "navigation@4"
        },
        {
          "command": "ck3lens.contracts.refresh",
          "when": "view == ck3lens.contractsView",
          "group": "navigation@1"
        },
        {
          "command": "ck3lens.contracts.fileBugReport",
          "when": "view == ck3lens.contractsView",
          "group": "navigation@2"
        }
      ],
      "view/item/context": [
        {
          "command": "ck3lens.rules.setSeverity",
          "when": "view == ck3lens.rulesView && viewItem == rule",
          "group": "inline"
        },
        {
          "command": "ck3lens.agent.reinitialize",
          "when": "view == ck3lens.agentView && viewItem == agent",
          "group": "inline"
        },
        {
          "command": "ck3lens.createOverridePatch",
          "when": "view == ck3lens.issuesView && viewItem == error",
          "group": "inline"
        },
        {
          "command": "ck3lens.createOverridePatch",
          "when": "view == ck3lens.issuesView && viewItem == conflict",
          "group": "inline"
        }
      ],
      "editor/context": [
        {
          "command": "ck3lens.goToDefinition",
          "when": "editorLangId == paradox-script",
          "group": "navigation"
        },
        {
          "command": "ck3lens.findReferences",
          "when": "editorLangId == paradox-script",
          "group": "navigation"
        },
        {
          "command": "ck3lens.validateFile",
          "when": "editorLangId == paradox-script",
          "group": "ck3lens"
        }
      ],
      "commandPalette": [
        {
          "command": "ck3lens.initSession",
          "when": "true"
        },
        {
          "command": "ck3lens.validateFile",
          "when": "editorLangId == paradox-script"
        }
      ]
    },
    "configuration": {
      "title": "CK3 Lens",
      "properties": {
        "ck3lens.databasePath": {
          "type": "string",
          "default": "",
          "description": "Path to ck3raven SQLite database. Leave empty for default (~/.ck3raven/ck3raven.db)"
        },
        "ck3lens.vanillaPath": {
          "type": "string",
          "default": "C:\\Program Files (x86)\\Steam\\steamapps\\common\\Crusader Kings III\\game",
          "description": "Path to CK3 vanilla game folder"
        },
        "ck3lens.modRoot": {
          "type": "string",
          "default": "",
          "description": "Path to CK3 mod directory. Leave empty for default"
        },
        "ck3lens.workshopPath": {
          "type": "string",
          "default": "",
          "description": "Path to Steam Workshop mods folder (steamapps/workshop/content/1158310)"
        },
        "ck3lens.pythonPath": {
          "type": "string",
          "default": "python",
          "description": "Path to Python executable for ck3raven"
        },
        "ck3lens.ck3ravenPath": {
          "type": "string",
          "default": "",
          "description": "Path to ck3raven installation. Leave empty to auto-detect"
        },
        "ck3lens.enableRealTimeLinting": {
          "type": "boolean",
          "default": true,
          "description": "Enable real-time linting on file changes"
        },
        "ck3lens.autoInitialize": {
          "type": "boolean",
          "default": true,
          "description": "Automatically initialize session when extension activates"
        },
        "ck3lens.lintOnSave": {
          "type": "boolean",
          "default": true,
          "description": "Validate files when saved"
        },
        "ck3lens.lintDelay": {
          "type": "number",
          "default": 500,
          "description": "Delay in milliseconds before linting after typing stops"
        },
        "ck3lens.showInlineHints": {
          "type": "boolean",
          "default": true,
          "description": "Show inline hints for symbol definitions"
        },
        "ck3lens.traceLevel": {
          "type": "string",
          "enum": [
            "off",
            "error",
            "info",
            "debug"
          ],
          "default": "info",
          "description": "Logging level for CK3 Lens"
        },
        "ck3lens.ipcPort": {
          "type": "number",
          "default": 9847,
          "description": "TCP port for diagnostics IPC server (for MCP tool access to IDE APIs)"
        },
        "ck3lens.widget.enabled": {
          "type": "boolean",
          "default": true,
          "description": "Enable the CK3 Lens floating widget"
        },
        "ck3lens.widget.anchor": {
          "type": "string",
          "enum": [
            "bottomRight",
            "bottomLeft",
            "topRight",
            "topLeft"
          ],
          "default": "bottomRight",
          "description": "Anchor position for the floating widget"
        },
        "ck3lens.widget.opacity": {
          "type": "number",
          "default": 0.95,
          "minimum": 0.1,
          "maximum": 1,
          "description": "Widget opacity (0.1-1.0)"
        },
        "ck3lens.widget.startCollapsed": {
          "type": "boolean",
          "default": false,
          "description": "Start the widget in collapsed state"
        },
        "ck3lens.agent.autoEngageOnLensEnable": {
          "type": "boolean",
          "default": false,
          "description": "Automatically engage the agent when lens is enabled"
        },
        "ck3lens.mode.default": {
          "type": "string",
          "enum": [
            "ck3lens",
            "ck3raven-dev",
            "ck3creator"
          ],
          "default": "ck3lens",
          "description": "Default mode when starting CK3 Lens"
        }
      }
    },
    "keybindings": [
      {
        "command": "ck3lens.goToDefinition",
        "key": "f12",
        "when": "editorLangId == paradox-script"
      },
      {
        "command": "ck3lens.findReferences",
        "key": "shift+f12",
        "when": "editorLangId == paradox-script"
      },
      {
        "command": "ck3lens.searchSymbols",
        "key": "ctrl+shift+o",
        "when": "editorLangId == paradox-script"
      },
      {
        "command": "ck3lens.toggleLens",
        "key": "ctrl+alt+l",
        "when": "true"
      },
      {
        "command": "ck3lens.selectMode",
        "key": "ctrl+alt+m",
        "when": "true"
      },
      {
        "command": "ck3lens.toggleAgentEngagement",
        "key": "ctrl+alt+a",
        "when": "true"
      },
      {
        "command": "ck3lens.openWidget",
        "key": "ctrl+alt+w",
        "when": "true"
      },
      {
        "command": "ck3lens.openStudio",
        "key": "ctrl+alt+n",
        "when": "true"
      }
    ],
    "colors": [
      {
        "id": "ck3lens.conflictHighlight",
        "description": "Background color for conflict highlights",
        "defaults": {
          "dark": "#ff990033",
          "light": "#ff990033",
          "highContrast": "#ff9900"
        }
      },
      {
        "id": "ck3lens.winnerHighlight",
        "description": "Background color for winning definition",
        "defaults": {
          "dark": "#00ff0022",
          "light": "#00ff0022",
          "highContrast": "#00ff00"
        }
      },
      {
        "id": "ck3lens.loserHighlight",
        "description": "Background color for overridden definition",
        "defaults": {
          "dark": "#ff000022",
          "light": "#ff000022",
          "highContrast": "#ff0000"
        }
      }
    ]
  },
  "scripts": {
    "vscode:prepublish": "npm run esbuild-base -- --production",
    "esbuild-base": "node esbuild.js",
    "esbuild": "npm run esbuild-base -- --sourcemap",
    "esbuild-watch": "npm run esbuild-base -- --watch",
    "compile": "npm run esbuild",
    "watch": "npm run esbuild-watch",
    "pretest": "npm run compile && npm run lint",
    "lint": "eslint src --ext ts",
    "test": "node ./out/test/runTest.js",
    "package": "npm run esbuild-base -- --production && vsce package --allow-missing-repository",
    "publish": "vsce publish"
  },
  "devDependencies": {
    "@types/js-yaml": "^4.0.9",
    "@types/node": "^20.10.0",
    "@types/vscode": "^1.85.0",
    "@typescript-eslint/eslint-plugin": "^6.13.0",
    "@typescript-eslint/parser": "^6.13.0",
    "@vscode/test-electron": "^2.3.8",
    "@vscode/vsce": "^2.22.0",
    "esbuild": "^0.20.2",
    "eslint": "^8.54.0",
    "typescript": "^5.3.2"
  },
  "dependencies": {
    "js-yaml": "^4.1.0",
    "jsonc-parser": "^3.2.0"
  }
}
